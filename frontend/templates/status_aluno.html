{% block body %}
<div class="container mt-4">
  <h2>Evolução das Skills de {{ aluno.nome_jovem }}</h2>
  {% if historico_pares %}
  <ul class="list-group">
    {% for par in historico_pares %}
    <li class="list-group-item mb-3">
      <strong>Data:</strong> {{ par.data.strftime('%d/%m/%Y %H:%M') }}<br />
      {% if par.anterior %}
      <ul>
        {% for skill, valor in par.atual.hard_skills.items() %} {% set diff =
        par.anterior.hard_skills.get(skill, 0) - valor %} {% if diff > 0 %}
        <li>
          Melhorou +{{ diff }} ponto{{ 's' if diff > 1 else '' }} em {{ skill }}
        </li>
        {% elif diff < 0 %}
        <li>
          Diminuiu {{ diff|abs }} ponto{{ 's' if diff < -1 else '' }} em {{
          skill }}
        </li>
        {% endif %} {% endfor %} {% for skill, valor in
        par.atual.soft_skills.items() %} {% set diff =
        par.anterior.soft_skills.get(skill, 0) - valor %} {% if diff > 0 %}
        <li>
          Melhorou +{{ diff }} ponto{{ 's' if diff > 1 else '' }} em {{ skill }}
        </li>
        {% elif diff < 0 %}
        <li>
          Diminuiu {{ diff|abs }} ponto{{ 's' if diff < -1 else '' }} em {{
          skill }}
        </li>
        {% endif %} {% endfor %}
      </ul>
      {% else %}
      <div>
        <strong>Snapshot inicial:</strong>
        <ul>
          {% for skill, valor in par.atual.hard_skills.items() %}
          <li>{{ skill }}: {{ valor }}</li>
          {% endfor %} {% for skill, valor in par.atual.soft_skills.items() %}
          <li>{{ skill }}: {{ valor }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="text-center"><em>Sem histórico de skills para este aluno.</em></p>
  {% endif %}
  <div class="mt-3">
    <a href="{{ url_for('chefe.acompanhar') }}" class="btn btn-secondary">Voltar</a>
  </div>
</div>

<!-- Toasts de Notificação -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
  <div
    id="toastNotificacao"
    class="toast align-items-center text-bg-success border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body" id="toastNotificacaoBody"></div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Fechar"
      ></button>
    </div>
  </div>
</div>

<!-- Script para exibir toasts após carregar base.js -->
<script>
  // Exibe toasts para mensagens flash do Flask
  {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
          {% for category, message in messages %}
              let corToast = 'success';
              if ('{{category}}' === 'error' || '{{category}}' === 'danger') corToast = 'danger';
              else if ('{{category}}' === 'warning') corToast = 'warning';

              showToast({{ message|tojson }}, corToast, 4000);
          {% endfor %}
      {% endif %}
  {% endwith %}
</script>
{% endblock %}
