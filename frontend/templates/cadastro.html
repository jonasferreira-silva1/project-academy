{% extends "base.html" %} {% set hide_navbar = True %} {% block title
%}Cadastro{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/cadastro.css') }}"
/>
{% endblock %} {% block body %}
<!-- Toasts de Notificação -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
  <div
    id="toastNotificacao"
    class="toast align-items-center border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body" id="toastNotificacaoBody"></div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Fechar"
      ></button>
    </div>
  </div>
</div>

<div
  class="container-cadastro mt-4"
  role="main"
  aria-label="Tela de cadastro do Educ+Invest"
>
  <section class="left-side" aria-label="Valores e missão do DashTalent">
    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path fill="#6a4c93" d="M23 27h18v10H23z" />
      </svg>
      <div class="feature-text">
        <h3>Conexão Eficiente</h3>
        <p>Ligamos jovens talentos e empresas com tecnologia de ponta.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <rect width="64" height="64" fill="#ffd166" rx="32" />
        <path fill="#6a4c93" d="M32 12a12 12 0 1 0 0 24 12 12 0 0 0 0-24z" />
      </svg>
      <div class="feature-text">
        <h3>Desenvolvimento Qualificado</h3>
        <p>Apoiamos a formação e crescimento dos jovens profissionais.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path fill="#6a4c93" d="M40 24h-16l-4 16h24l-4-16z" />
      </svg>
      <div class="feature-text">
        <h3>ODS 8.6</h3>
        <p>Compromisso com a redução do desemprego juvenil global.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path fill="#6a4c93" d="M21 38h22v4H21z" />
      </svg>
      <div class="feature-text">
        <h3>Transparência</h3>
        <p>Dados seguros para decisões claras entre empresas e instituições.</p>
      </div>
    </div>
  </section>

  <section class="right-side" aria-label="Formulário de cadastro">
    <form
      method="POST"
      class="form-box"
      onsubmit="return validarFormulario()"
      novalidate
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <a href="{{url_for('users.carousel')}}">
        <h2 class="text-center">DashTalent</h2>
      </a>
      <p class="text-center">
        Conectando talentos, instituições e empresas para construir futuros de
        sucesso.
      </p>
      <br />
      <div class="welcome-text" tabindex="0">Bem-vindo! Faça seu cadastro.</div>

      <!-- Tipo de usuário -->
      <div class="mb-3">
        <label class="form-label">Tipo de cadastro (*)</label>
        <select
          name="tipo_usuario"
          id="tipoUsuario"
          class="form-select"
          required
        >
          <option value="" selected disabled>Selecione</option>
          <option value="chefe">Chefe</option>
          <option value="instituicao">Instituição de Ensino</option>
        </select>
      </div>

      <!-- Campos comuns -->
      <div class="mb-3">
        <label for="nome" class="form-label">Nome de usuário (*)</label>
        <input
          type="text"
          name="nome"
          class="form-control"
          id="nome"
          placeholder="Nome de usuário"
          required
          oninput="filtrarEntrada(this, 'letras')"
          minlength="3"
          maxlength="30"
          pattern="[A-Za-zÀ-ÿ\s]+"
          title="Apenas letras, mínimo de 3 e máximo de 30 caracteres"
        />
        <div id="erro-nome" class="invalid-feedback"></div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">E-mail (*)</label>
        <input
          type="email"
          name="email"
          id="email"
          class="form-control"
          placeholder="exemplo@dominio.com"
          required
          maxlength="50"
          title="Insira um e-mail válido com até 50 caracteres"
          onblur="validarEmail(this)"
        />
        <div id="erro-email" class="invalid-feedback"></div>
      </div>
      <div class="row">
        <div class="col-12 col-md-6 mb-3">
          <label for="senha" class="form-label">Senha (*)</label>
          <input
            type="password"
            name="senha"
            id="senha"
            class="form-control"
            placeholder="Senha com no mínimo 6 caracteres"
            required
            minlength="6"
            maxlength="20"
            oninput="validarSenha(this)"
            title="Senha entre 6 e 20 caracteres"
          />
          <div id="erro-senha" class="invalid-feedback"></div>
          <small id="forca-senha" class="form-text"></small>
        </div>
        <div class="col-12 col-md-6 mb-3">
          <label for="confirmarSenha" class="form-label"
            >Repita a senha (*)</label
          >
          <input
            type="password"
            name="confirmar_senha"
            id="confirmarSenha"
            class="form-control"
            placeholder="Repita a senha"
            required
            minlength="6"
            maxlength="20"
            oninput="validarConfirmacaoSenha()"
            title="Confirme a senha com o mesmo número de caracteres"
          />
        </div>
        <div id="erro-confirmarSenha" class="invalid-feedback"></div>
      </div>

      <!-- Campos específicos para instituição -->
      <div id="camposInstituicao" style="display: none">
        <div class="mb-3">
          <label class="form-label">Nome da Instituição (*)</label>
          <input
            type="text"
            name="instituicao_nome"
            id="instituicao_nome"
            class="form-control"
            placeholder="Instituição"
            required
            maxlength="30"
            pattern="[A-Za-zÀ-ÿ\s]+"
            title="Apenas letras. Máximo de 30 caracteres"
          />
          <div id="erro-instituicao_nome" class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Endereço da Instituição (*)</label>
          <input
            type="text"
            name="endereco_instituicao"
            id="endereco_instituicao"
            class="form-control"
            placeholder="Endereço"
            required
            maxlength="80"
            title="Máximo de 80 caracteres"
          />
          <div id="erro-endereco_instituicao" class="invalid-feedback"></div>
        </div>
        <div class="mb-3">
          <label for="cpf" class="form-label">CNPJ (*)</label>
          <input
            type="text"
            name="instituicao_cnpj"
            id="cnpj"
            class="form-control"
            placeholder="CNPJ (somente números)"
            required
            maxlength="14"
            minlength="14"
            pattern="\d{14}"
            inputmode="numeric"
            title="Informe exatamente 14 números do CNPJ"
          />
          <div id="erro-cnpj" class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Infraestrutura (*)</label>
          <textarea
            name="infraestrutura"
            id="infraestrutura"
            class="form-control"
            placeholder="Descreva a infraestrutura da instituição. Exemplo:2 Blocos, com 3 Laboratórios cada, com 1 Refeitório cada e 1 Auditório"
            required
            maxlength="150"
            minlength="20"
            title="Mínimo de 20 e máximo de 150 caracteres"
          ></textarea>
          <div id="erro-infraestrutura" class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Nota MEC (*)</label>
          <input
            type="number"
            name="nota_mec"
            class="form-control"
            min="1"
            max="5"
            step="1"
            placeholder="Nota MEC (1 a 5)"
            required
            id="nota_mec_input"
            inputmode="numeric"
            pattern="[1-5]"
          />
          <div id="erro-nota_mec_input" class="invalid-feedback"></div>
          <small class="text-muted">Digite um valor entre 1 e 5.</small>
        </div>

        <div class="mb-3">
          <label class="form-label">Cursos da Instituição (*)</label>
          <div class="row" id="cursos_container">
            {% for curso in cursos_padrao %}
            <div class="col-12 col-md-6">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="cursos_selecionados"
                  id="curso_{{ loop.index }}"
                  value="{{ curso }}"
                />
                <label class="form-check-label" for="curso_{{ loop.index }}"
                  >{{ curso }}</label
                >
              </div>
            </div>
            {% endfor %}
          </div>
          <div
            id="erro-cursos"
            class="invalid-feedback d-block text-danger"
          ></div>
          <small class="text-muted">Selecione um ou mais cursos.</small>
        </div>

        <div class="mb-3">
          <label class="form-label">Modalidades (*)</label>
          <select
            name="modalidades"
            id="modalidades"
            class="form-select"
            required
          >
            <option value="" disabled selected>Selecione a modalidade</option>
            <option value="Presencial">Presencial</option>
            <option value="Híbrido">Híbrido</option>
            <option value="EAD">EAD</option>
          </select>
          <div id="erro-modalidades" class="invalid-feedback"></div>
        </div>
      </div>

      <!-- Campos específicos para chefe -->
      <div id="camposChefe" style="display: none">
        <div class="mb-3">
          <label class="form-label">Nome da Empresa (*)</label>
          <input
            type="text"
            name="empresa_nome"
            id="empresa_nome"
            class="form-control"
            placeholder="Nome da empresa"
            required
            maxlength="30"
            pattern="[A-Za-zÀ-ÿ\s]+"
            title="Apenas letras. Máximo de 30 caracteres"
          />
          <div id="erro-empresa_nome" class="invalid-feedback"></div>
        </div>
        <div class="mb-3">
          <label class="form-label">Cargo (*)</label>
          <select name="cargo" id="cargo" class="form-select" required>
            <option value="" selected disabled>Selecione o cargo</option>
            <option value="CEO">CEO</option>
            <option value="Gerente">Gerente</option>
            <option value="Coordenador">Coordenador</option>
          </select>
          <div id="erro-cargo" class="invalid-feedback"></div>
        </div>
      </div>

      <button type="submit" class="btn btn-success w-100">Cadastrar</button>
      <p class="mt-3">
        Já tem conta? <a href="{{ url_for('auth.login') }}">Faça login</a>
      </p>

      <!-- Toasts de Notificação -->
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
        <div
          id="toastNotificacao"
          class="toast align-items-center text-bg-success border-0"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="d-flex">
            <div class="toast-body" id="toastNotificacaoBody"></div>
            <button
              type="button"
              class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
              aria-label="Fechar"
            ></button>
          </div>
        </div>
      </div>
    </form>
  </section>
</div>

<script src="{{ url_for('static', filename='js/cadastro.js') }}"></script>

<!-- Toasts de Notificação -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
  <div id="toastNotificacao" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastNotificacaoBody"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
    </div>
  </div>
</div>

<!-- Script para exibir toasts após carregar base.js -->
<script>
    // Aguarda o carregamento completo da página para garantir que base.js foi carregado
    document.addEventListener('DOMContentLoaded', function() {
        // Aguarda um pouco mais para garantir que base.js foi carregado
        setTimeout(function() {
            // Exibe toasts para mensagens flash do Flask
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    console.log("Mensagens flash recebidas:", {{ messages|tojson }});
                    {% for category, message in messages %}
                        let corToast = 'success';
                        if ('{{category}}' === 'error' || '{{category}}' === 'danger') corToast = 'danger';
                        else if ('{{category}}' === 'warning') corToast = 'warning';

                        // Verifica se showToast está disponível antes de chamar
                        if (typeof showToast === 'function') {
                            console.log("Exibindo toast:", {{ message|tojson }}, corToast);
                            showToast({{ message|tojson }}, corToast, 4000);
                        } else {
                            console.error('showToast não está disponível');
                        }
                    {% endfor %}
                {% else %}
                    console.log("Nenhuma mensagem flash para exibir.");
                {% endif %}
            {% endwith %}
        }, 100);
    });
</script>
{% endblock %}
