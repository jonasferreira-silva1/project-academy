{% extends "base.html" %} {% set hide_navbar = True %} {% block title
%}Verificar Código - DashTalent{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/esqueceu_senha.css') }}"
/>
{% endblock %} {% block body %}
<div
  class="container-login mt-4"
  role="main"
  aria-label="Verificação de código"
>
  <section class="left-side" aria-label="Informações sobre verificação">
    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path fill="#6a4c93" d="M20 25h24v14H20z M22 27v10h20V27z" />
      </svg>
      <div class="feature-text">
        <h3>Código Enviado</h3>
        <p>Verifique sua caixa de entrada e spam.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <rect width="64" height="64" fill="#ffd166" rx="32" />
        <path fill="#6a4c93" d="M32 16l8 8h-6v16h-4V24h-6l8-8z" />
      </svg>
      <div class="feature-text">
        <h3>Válido por 15 minutos</h3>
        <p>O código expira em 15 minutos por segurança.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path
          fill="#6a4c93"
          d="M32 20c-6.6 0-12 5.4-12 12s5.4 12 12 12 12-5.4 12-12-5.4-12-12-12zm-2 18l-6-6 2.8-2.8L30 32.4l7.2-7.2L40 28l-10 10z"
        />
      </svg>
      <div class="feature-text">
        <h3>Máximo 5 tentativas</h3>
        <p>Após 5 tentativas incorretas, solicite um novo código.</p>
      </div>
    </div>

    <div class="feature">
      <svg
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 64 64"
      >
        <circle cx="32" cy="32" r="30" fill="#ffd166" />
        <path
          fill="#6a4c93"
          d="M32 20c-6.6 0-12 5.4-12 12s5.4 12 12 12 12-5.4 12-12-5.4-12-12-12zm0 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z"
        />
      </svg>
      <div class="feature-text">
        <h3>Segurança Total</h3>
        <p>Processo criptografado e monitorado.</p>
      </div>
    </div>
  </section>

  <section class="right-side" aria-label="Formulário de verificação de código">
    <a href="{{url_for('users.carousel')}}">
      <h2 class="text-center">DashTalent</h2>
    </a>
    <br />
    <div class="welcome-text" tabindex="0">Digite o código</div>
    <p class="subtitle">
      Enviamos um código de 6 dígitos para: <strong>{{ email }}</strong>
    </p>

    <form
      method="POST"
      action="{{ url_for('esquece.verificar_codigo_post') }}"
      class="form-box"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <input type="hidden" name="email" value="{{ email }}" />

      <div class="mb-3">
        <label for="codigo" class="form-label">Código de Verificação</label>
        <input
          type="text"
          id="codigo"
          name="codigo"
          class="form-control codigo-input"
          placeholder="000000"
          maxlength="6"
          pattern="[0-9]{6}"
          required
        />
        <small class="form-text text-muted">Digite o código de 6 dígitos</small>
      </div>

      <button type="submit" class="btn btn-primary w-100">
        Verificar Código
      </button>

      <div class="mt-3 text-center">
        <a href="{{ url_for('esquece.esqueceu_senha') }}" class="login-link"
          >Solicitar novo código</a
        ><br /><br />
        <a href="{{ url_for('auth.login') }}" class="login-link"
          >Voltar ao Login</a
        >
      </div>
    </form>
  </section>
</div>

<!-- Toast de Notificação -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
  <div
    id="toastNotificacao"
    class="toast align-items-center text-bg-success border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body" id="toastNotificacaoBody"></div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Fechar"
      ></button>
    </div>
  </div>
</div>

<script>
  // Formatação automática do código
  document.getElementById('codigo').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 6) value = value.slice(0, 6);
      e.target.value = value;
  });

  // showToast está definido em base.js

  document.addEventListener('DOMContentLoaded', function() {
      {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
              {% for category, message in messages %}
                  showToast({{ message|tojson }},
                            "{{ 'success' if category == 'success' else ('warning' if category == 'warning' else 'danger') }}");
              {% endfor %}
          {% endif %}
      {% endwith %}
  });
</script>
{% endblock %}
