{% extends "base.html" %} {% set hide_navbar = False %} {% block title %}Cursos
- DashTalent{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/cursos.css') }}"
/>
{% endblock %} {% block body %}
<div class="container mt-4">
  <div
    class="d-flex justify-content-between align-items-center mb-4 position-relative"
  >
    <a
      href="{{ url_for('auth.home') }}"
      class="back-circle position-absolute start-0"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        fill="white"
        class="bi bi-arrow-left"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M15 8a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 7.5H14.5a.5.5 0 0 1 .5.5z"
        />
      </svg>
    </a>
    <h1 class="m-0 w-100 text-center page-title">Cursos da Instituição</h1>
  </div>

  <div class="text-center"><p>Cadastre um novo curso!</p></div>

  {% if cursos|length == 0 %}
  <div class="text-center">
    <p class="lead">Nenhum curso cadastrado.</p>
  </div>
  {% else %}
  <ul class="list-group list-group-flush mb-4">
    {% for curso in cursos %}
    <li class="list-group-item fs-5">{{ curso.nome }}</li>
    {% endfor %}
  </ul>
  {% endif %}

  <div class="container mb-4 text-center">
    <button
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#cadastroCursosModal"
    >
      Cadastrar Novo Curso
    </button>
  </div>
  <!-- Modal -->

  <div
    class="modal fade"
    id="cadastroCursosModal"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 rounded-4">
        <div class="modal-header">
          <h5 class="modal-title">Cadastro de Curso</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Fechar"
          ></button>
        </div>
        <form action="{{ url_for('instituicao.cursos') }}" method="POST">
          <!-- CSRF: campo hidden para proteção contra Cross-Site Request Forgery -->
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <div class="modal-body">
            <div class="mb-3">
              <label for="curso" class="form-label">Nome do Curso</label>
              <select id="curso" name="curso" class="form-select" required>
                <option value="" disabled selected>Selecione o curso</option>
                {% for curso in CURSOS_PADRAO %}
                <option value="{{ curso }}">{{ curso }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-success">Cadastrar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toasts de Notificação -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div
      id="toastNotificacao"
      class="toast align-items-center text-bg-success border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body" id="toastNotificacaoBody">
          <!-- Mensagem via JS -->
        </div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Fechar"
        ></button>
      </div>
    </div>
  </div>
  <br />

  <script src="{{ url_for('static', filename='js/cursos.js') }}"></script>
  <!-- Bootstrap Icons CDN para ícones -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />

  <!-- Toasts de Notificação -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div
      id="toastNotificacao"
      class="toast align-items-center text-bg-success border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body" id="toastNotificacaoBody"></div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Fechar"
        ></button>
      </div>
    </div>
  </div>

  <!-- Script para exibir toasts após carregar base.js -->
  <script>
    // Aguarda o carregamento completo da página para garantir que base.js foi carregado
    document.addEventListener('DOMContentLoaded', function() {
        // Aguarda um pouco mais para garantir que base.js foi carregado
        setTimeout(function() {
            // Exibe toasts para mensagens flash do Flask
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    console.log("Mensagens flash recebidas:", {{ messages|tojson }});
                    {% for category, message in messages %}
                        let corToast = 'success';
                        if ('{{category}}' === 'error' || '{{category}}' === 'danger') corToast = 'danger';
                        else if ('{{category}}' === 'warning') corToast = 'warning';

                        // Verifica se showToast está disponível antes de chamar
                        if (typeof showToast === 'function') {
                            console.log("Exibindo toast:", {{ message|tojson }}, corToast);
                            showToast({{ message|tojson }}, corToast, 4000);
                        } else {
                            console.error('showToast não está disponível');
                        }
                    {% endfor %}
                {% else %}
                    console.log("Nenhuma mensagem flash para exibir.");
                {% endif %}
            {% endwith %}
        }, 100);

        // Teste manual da função showToast (remover após debug)
        setTimeout(function() {
            if (typeof showToast === 'function') {
                console.log("Teste: showToast está disponível");
                // showToast("Teste de toast", "success", 3000);
            } else {
                console.error("Teste: showToast NÃO está disponível");
            }
        }, 200);
    });
  </script>
  {% endblock %}
</div>
